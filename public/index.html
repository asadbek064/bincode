<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BinCode</title>
    <link rel="icon" type="image/png" href="./logo/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="./logo/favicon.svg" />
    <link rel="shortcut icon" href="./logo/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />

    <link rel="stylesheet" href="/style.css" />
    <link rel="stylesheet" href="./font.css">
  </head>
  <body>
    <div id="app">
      <nav>
        <div class="brand">BinCode</div>
        <div class="title-input" v-if="token">
          <input type="text" v-model="title" placeholder="Snippet title" />
        </div>
        <div class="toggle-container">
          <button class="toggle-icon" @click="toggleEditor" :title="showEditor ? 'Hide editor' : 'Show editor'">
            <span v-html="showEditor ? icons.visible : icons.hidden"></span>
            <span>editor</span>
          </button>

          <button class="toggle-icon" @click="togglePreview" :title="showPreview ? 'Hide preview' : 'Show preview'">
            <span v-html="showPreview ? icons.visible : icons.hidden"></span>
            <span>preview</span>
          </button>

          <button class="toggle-icon" @click="toggleConsole" :title="showConsole ? 'Hide console' : 'Show console'">
            <span v-html="showConsole ? icons.console : icons.console_hidden"></span>
            <span>console</span>
          </button>

          <button
            class="toggle-icon"
            @click="toggleExecution"
            :class="{ 'toggle-active': isExecutionPaused }"
            :title="isExecutionPaused ? 'Resume live preview' : 'Pause live preview'"
          >
            <span v-html="isExecutionPaused ? icons.play : icons.pause"></span>
            <span>{{ isExecutionPaused ? 'live' : 'pause' }}</span>
          </button>
        </div>
        <div class="nav-actions">
          <div class="auth-buttons" v-if="!token">
            <button @click="showLogin = true">Login</button>
          </div>
          <div class="user-menu" v-else>
            <button @click="saveSnippet" class="primary" :disabled="isSaving">
              {{ isSaving ? 'Saving...' : 'Save' }}
            </button>
            <button @click="logout">Logout</button>
          </div>
        </div>
      </nav>

      <div class="editor-container">
        <div
          class="editor-group"
          v-show="showEditor"
          :style="{ width: editorWidth }"
        >
          <!-- Tab bar -->
          <div class="tab-bar">
            <button
              v-for="tab in tabs"
              :key="tab.id"
              class="tab"
              :class="{ active: activeTab === tab.id }"
              @click="switchTab(tab.id)"
            >
            <svg class="tab-icon" v-html="tab.icon"></svg>
              {{ tab.label }}
            </button>
          </div>

          <!-- Editor content - Monaco Editor will be injected here -->
          <div class="editor-content" ref="monacoEditor"></div>
        </div>

        <!-- Resize handle -->
        <div class="resize-handle" 
          v-show="showEditor && showPreview" 
          @mousedown="startResize"
          @touchstart="startResize"
        ></div>

        <div
          class="preview"
          :style="{ width: previewWidth }"
          v-show="showPreview"
        >
          <iframe id="preview-frame"></iframe>
        </div>
    
    </div>

      <!-- Share Modal -->
      <div
        class="modal"
        v-if="showShareModal"
        @click.self="showShareModal = false"
      >
        <div class="modal-content">
          <h2>Share Snippet</h2>
          <div class="share-url">
            <input type="text" :value="shareUrl" readonly ref="shareUrlInput" />
            <button @click="copyShareUrl" class="primary">Copy</button>
          </div>
          <button class="close" @click="showShareModal = false">&times;</button>
        </div>
      </div>

      <!-- Login Modal -->
      <div class="modal" v-if="showLogin" @click.self="showLogin = false">
        <div class="modal-content">
          <h2>Login</h2>
          <form @submit.prevent="login">
            <input
              type="email"
              v-model="loginEmail"
              placeholder="Email"
              required
              :disabled="isLoggingIn"
            />
            <input
              type="password"
              v-model="loginPassword"
              placeholder="Password"
              required
              :disabled="isLoggingIn"
            />
            <button type="submit" class="primary" :disabled="isLoggingIn">
              {{ isLoggingIn ? 'Logging in...' : 'Login' }}
            </button>
          </form>
          <button class="close" @click="showLogin = false">&times;</button>
        </div>
      </div>

      <!-- Toast Notification -->
      <transition name="toast">
        <div v-if="toast.show" class="toast" :class="`toast-${toast.type}`">
          {{ toast.message }}
        </div>
      </transition>
    </div>

    <!-- use`_dev` or `_prod` lib for vuejs based on env -->
    <script src="./libraries/vue/vuejs_3.5.13_prod.js"></script>

    <!-- Monaco Editor - load CSS first -->
    <link rel="stylesheet" href="./libraries/monaco-editor/vs/editor/editor.main.css" />

    <!-- Monaco Editor loader and main -->
    <script>
      var require = { paths: { vs: './libraries/monaco-editor/vs' } };
    </script>
    <script src="./libraries/monaco-editor/vs/loader.js"></script>
    <script src="./libraries/monaco-editor/vs/editor/editor.main.nls.js"></script>
    <script src="./libraries/monaco-editor/vs/editor/editor.main.js"></script>

    <!-- Main app - loads after Monaco is ready -->
    <script src="/app.js"></script>
  </body>
</html>
